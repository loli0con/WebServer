# WebServer

## 前置知识点

### 客户端/服务器架构

### 套接字
* 套接字是计算机网络数据结构，是一个"通信端点"
* 套接字用于进程间通信
* 有两种类型的套接字：基于文件的和面向网络的

#### UNIX套接字
一个套接字家族，基于文件，家族名字为AF_UNIX
#### 网络套接字
基于网络，家族名字为AF_INET。
另一个地址家族AF_INET6用于IPv6寻址。

#### 其他套接字
python还支持AF_NETLINK和AF_TIPC家族，这两个都是Linux套接字，是Linux的特性。

> 个人的理解是，地址家族是一种寻址的方案。寻址，故名意义，寻找地址，其目的应该是通过某种方式让进程可以被发现，这是建立联系并交换数据（即通讯）的基础。

## 套接字类型
不管是哪种地址家族，都有两种不同的风格的套接字连接：
* 面向连接
* 无连接

### 面向连接
这种类型的通讯也被称为**虚电路**或者**流套接字**。

面向连接的套接字提供序列化的、可靠的和不重复的数据交互，而且没有记录边界。
这基本上意味着每条消息可以被拆分成多个片段，并且每一条片段看都确保能够到达目的地，然后将它们按照顺序组合在一起，最后将完整的消息传递给正在等待的应用程序。

实现这种连接类型的主要协议是TCP。  
为了创建TCP套接字，必须使用SOCK_STREAM作为套接字类型。

### 无连接
数据报类型的套接字，是一种无连接的套接字。这意味着通讯之前不需要建立连接（*三次握手？*），但此时无法保证数据传输过程中的顺序性、可靠性和完整性。
然后数据报确实保留了记录边界，即消息是以整体发送的，而非拆分成多个片段。少去了设置和建立并维护连接的开销，数据报拥有更好的性能。

实现这种连接类型的主要协议是UDP。  
为了创建UDP套接字，必须使用SOCK_DGRAM作为套接字类型。
> datagram ➡️ DGRAM

## 代码
|版本|说明|
|-----|-----|
|v0|模版|
|v1|同步的tcp服务器|
|v2|多线程的tcp服务器|
|v3|多进程的tcp服务器|
|v4|非阻塞的tcp服务器|
|v5|select版的tcp服务器|

## v5
### 参考文章
https://www.cnblogs.com/huchong/p/8613308.html  
https://www.cnblogs.com/leijiangtao/p/11883310.html  
https://blog.csdn.net/shy_hc/article/details/69950334  
https://aceld.gitbooks.io/python/content/fu-wu-qi-mo-xing/select7248-tcp-fu-wu-qi.html  
https://zhuanlan.zhihu.com/p/77275039

### 碎碎念
花了一点时间写select版本你的服务器，有点难度。
期间还偶遇了一个关于tcp拆包的问题，其实也不算遇到，就是突然想起了。
之前的模型都是"一问一答式"——客户端和服务器会等待对方，
但我设想了一下客户端发数据*send*足够快，或者说比服务器收数据*recv*要快，这时候会发生什么情况？
想到实际的收发数据是操作系统完成的，程序只是在读写缓冲区而已，所以可能会是"N问一答"。
一开始想问别人，主要是不知道应该谷歌什么关键词，但是发现没人可问，就试试"tcp拆包"关键词，然后幸运地找到了答案。